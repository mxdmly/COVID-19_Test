<!DOCTYPE html>
<html>
<head>
	<title>检测结果上报表</title>
	<style>
		table{
			text-align: center;
			margin: 0;
			width: 100%;
			border: 10px solid rgb(151, 228, 164);
		}
		input{
			text-align: center;
		}
	</style>
	<script src="js/jquery.js"></script>
	<script src="js/myTool.js"></script>
	<script>
		//假如有个json数据在这里
		var myJson_str = new String("[{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"张三\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"李四\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"},{\"ID\":\"01\",\"isUpload\":\"1\",\"name\":\"王五\",\"idType\":\"441202199702145210\"}]");
		$(document).ready(function () {//网页载入后立即执行的函数
			//$("#myListTable").on(displaySpecialEffects());
			getList();
		});
		function getList() { //获取数据库列表
			$("#myListTable tr:not(:first)").remove();//删除第一行以外的数据
            $.ajax({
                //type:'post',
                //dataType:'text',
                url:'lis_COVID19_TestCheck.jsp',
                //data:$("#peopleInfo").serializeArray(),
                success:function(result){
					//result = myJson_str;//jsp会返回一个json字符串
					//console.log(result);
					let myTestJson_json;
					let isJson_b;
					try {//如果不是json或为空就会报错
						myTestJson_json = JSON.parse(result);
						isJson_b = true;
						$("#allCheck").prop("checked", true);
					} catch (e) {
						isJson_b = false;
						$("#allCheck").prop("checked", false);
						$("#myListTable").append("<tr><td>无数据</td></tr>");
						//console.log(e);
						//alert("服务器没有数据");
					}
					if (isJson_b) {
						let dispaly_str = "";
						let jsonLen_i = myTestJson_json.length;
						//console.log(jsonLen_i);
						for (let i = 0; i < jsonLen_i; i++) {
							let itemJson = myTestJson_json[i];
							if(itemJson.isUpload == "1"){
								let tempi_i = i + 1;//table的序号，不作实际用途
								dispaly_str = dispaly_str + "<tr>" + 
									"<td>" + tempi_i + "</td>" + 
									"<td><input type=\"checkbox\" checked=\"ture\"/></td>" + 
									"<td>" + itemJson.name + "</td>" + 
									"<td>" + itemJson.idType + "</td>" + 
									"<td>阴性</td>" + 
									"<td><input type=\"text\" value=\"" + myTool_getThisTime() + "\"/>" + 
									"<td>" + itemJson.samplingTime + "</td>" + 
									"<td>" + itemJson.ID + "</td>";
							}
							dispaly_str = dispaly_str + "</tr>";
						}
						console.log(dispaly_str);
						$("#myListTable").append(dispaly_str);
						$("#myListTable tr:not(:first)").off();//移除事件重新绑定，不然会重复绑定越来越卡
						displaySpecialEffects();
					}
                }
            })
		}
		//获取复选框的值上传
		//上传的时候需要有SQL server的ID、是否勾选、结果、时间，用json保存和传输
		function uploadList() {
			$("#myListTable tr:not(:first)").each(function () {
				var ss = $(this).find("td").eq(1).html();
				var sss = $(this).find("td").eq(5).html();
				console.log(ss + "  " + sss);
			})
			$("#tips").val("成功");
		}
		function displaySpecialEffects() {//给每行添加选中特效，点击效果
			var tr_se = $("#myListTable tr:not(:first)");
			tr_se.mouseover(function () {
				$(this).css("background-color","rgb(216,227,231)");
			});
			tr_se.mouseout(function () {
				$(this).css("background-color","white");
			});
			tr_se.click(function (e) {
				console.log("str");//记得删除
				var myCheck = $(this).find("td:eq(1) input:eq(0)");
				if($(e.target).html() != ""){//如果点击框框就会返回空白，解决点击框框不勾选或乱勾选的问题
					myCheck.prop("checked", ! myCheck.prop("checked"));
				}
				//跟下面的函数关联
				var trLen_i = $("#myListTable tr:not(:first)").length;//查找table列数
				$("#myListTable tr:not(:first)").each(function () {
					if($(this).find("td:eq(1) input:eq(0)").prop("checked")){
						trLen_i = trLen_i - 1;
					}
				})
				if(trLen_i <= 0){//如果打勾的列数等于总列数就把全选打上勾，反之不打勾
					$("#myListTable tr:first td:eq(1) input:eq(0)").prop("checked", true);
				}else{
					$("#myListTable tr:first td:eq(1) input:eq(0)").prop("checked", false);
				}
			});
		}
		function myAllCheck() {//全选
			if($("#myListTable tr:first td:eq(1) input:eq(0)").prop("checked")){
				$("#myListTable tr:not(:first)").each(function () {
					$(this).find("td:eq(1) input:eq(0)").prop("checked", true);
				})
			}else{
				$("#myListTable tr:not(:first)").each(function () {
					$(this).find("td:eq(1) input:eq(0)").prop("checked", false);
				})
			}
		}
	</script>
</head>
<body>
	<div>
		<div style="margin-top: 10px;margin-bottom:10px;float: right;">
			<b id="tips"></b>
			<input type="button" value="结果上报" onclick="uploadList()" style="width: 100px;padding: 10px;"/>
			<input type="button" value="刷新" onclick="getList()" style="width: 100px; padding: 10px;"/>
		</div>
		<table id="myListTable" data-="">
			<tr style="background-color: rgb(129, 230, 191);">
				<td>序号</td>
				<td>是否上报<br><label for="allCheck" style="font-size: 10px;">（全选<input type="checkbox" id="allCheck" onclick="myAllCheck()" checked="ture" style="width: 10px;vertical-align: -10%;" />）</label></td>
				<td>姓名</td>
				<td>身份证</td>
				<td>检测结果</td>
				<td>检测时间</td>
				<td>采样时间</td>
			</tr>
		</table>
		<div style="margin-top: 10px;float: left;">
			<input type="button" value="前一页" id="turnLeft" onclick="" style="height:25px;"/>
			<input type="text" value="1" id="page" style="width:19px;height:19px;text-align:center;"/>
			<input type="button" value="后一页" id="turnRight" onclick="" style="height:25px;"/>
		</div>
	</div>
</body>
</html>




			<!--
			<tr>
				<td>1</td>
				<td><input type="checkbox" checked="ture" /></td>
				<td>张三</td>
				<td>441202199702145210</td>
				<td>阴性</td>
				<td><input type="text" value="2021/1/01 12:00:00"/></td>
			</tr>
			<tr>
				<td>2</td>
				<td><input type="checkbox" checked="ture" /></td>
				<td>李四</td>
				<td>441202199702145210</td>
				<td>阴性</td>
				<td><input type="text" value="2021/1/01 12:00:00"/></td>
			</tr>
			<tr>
				<td>3</td>
				<td><input type="checkbox" checked="ture"/></td>
				<td>王五</td>
				<td>441202199702145210</td>
				<td>阴性</td>
				<td><input type="text" value="2021/1/01 12:00:00"/></td>
			</tr>
		-->